<!--
  *********************************************************************************
  *  sql syntax rules:
  *  1.  Do not code column aliases.  This will mess up the selection criteria page.
  *  2.  Do not specify the sort clause in your sql.  The sort order will be specified
  *      by the user.
  *  3.  You may, but are not required to specify the where clause
  *********************************************************************************
-->

<report>
  <id>siunpaEstadisctico</id>
  <title>Estadistico SIUNPA</title>
  <sql>
SELECT DESCRIPTION as MATERIAL,
IF(ISNULL(ENERO),'0',ENERO) AS ENERO,
IF(ISNULL(FEBRERO),'0',FEBRERO) AS FEBRERO,
IF(ISNULL(MARZO),'0',MARZO) AS MARZO,
IF(ISNULL(ABRIL),'0',ABRIL) AS ABRIL,
IF(ISNULL(MAYO),'0',MAYO) AS MAYO,
IF(ISNULL(JUNIO),'0',JUNIO) AS JUNIO,
IF(ISNULL(JULIO),'0',JULIO) AS JULIO,
IF(ISNULL(AGOSTO),'0',AGOSTO) AS AGOSTO,
IF(ISNULL(SEPTIEMBRE),'0',SEPTIEMBRE) AS SEPTIEMBRE,
IF(ISNULL(OCTUBRE),'0',OCTUBRE) AS OCTUBRE,
IF(ISNULL(NOVIEMBRE),'0',NOVIEMBRE) AS NOVIEMBRE,
IF(ISNULL(DICIEMBRE),'0',DICIEMBRE) AS DICIEMBRE,
IF(ISNULL(ENERO),'0',ENERO) +
IF(ISNULL(FEBRERO),'0',FEBRERO) +
IF(ISNULL(MARZO),'0',MARZO) +
IF(ISNULL(ABRIL),'0',ABRIL) +
IF(ISNULL(MAYO),'0',MAYO) +
IF(ISNULL(JUNIO),'0',JUNIO) +
IF(ISNULL(JULIO),'0',JULIO) +
IF(ISNULL(AGOSTO),'0',AGOSTO) +
IF(ISNULL(SEPTIEMBRE),'0',SEPTIEMBRE) +
IF(ISNULL(OCTUBRE),'0',OCTUBRE) +
IF(ISNULL(NOVIEMBRE),'0',NOVIEMBRE) +
IF(ISNULL(DICIEMBRE),'0',DICIEMBRE) AS TOTALES
FROM material_type_dm M
LEFT JOIN
(
SELECT MATERIAL_CD,
MAX(ENERO) AS ENERO,MAX(FEBRERO) AS FEBRERO,MAX(MARZO) AS MARZO,MAX(ABRIL) AS ABRIL,
MAX(MAYO) AS MAYO,MAX(JUNIO) AS JUNIO,MAX(JULIO) AS JULIO,MAX(AGOSTO) AS AGOSTO,MAX(SEPTIEMBRE) AS SEPTIEMBRE,
MAX(OCTUBRE) AS OCTUBRE,MAX(NOVIEMBRE) AS NOVIEMBRE,MAX(DICIEMBRE) AS DICIEMBRE
FROM
(
SELECT MATERIAL_CD, count(bibid) AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '01'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, count(bibid) AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '02'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, count(bibid) AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '03'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, count(bibid) AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '04'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, count(bibid) AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '05'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, count(bibid) AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '06'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, count(bibid) AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '07'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, count(bibid) AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '08'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, count(bibid) AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '09'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, count(bibid) AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '10'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, count(bibid) AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '11'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, count(bibid) AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '12'
GROUP BY MATERIAL_CD
) A
GROUP BY MATERIAL_CD
) B ON B.MATERIAL_CD = M.CODE
UNION
SELECT 'Totales' as MATERIAL,
SUM(ENERO),
SUM(FEBRERO),
SUM(MARZO),
SUM(ABRIL),
SUM(MAYO),
SUM(JUNIO),
SUM(JULIO),
SUM(AGOSTO),
SUM(SEPTIEMBRE),
SUM(OCTUBRE),
SUM(NOVIEMBRE),
SUM(DICIEMBRE),
SUM(TOTALES)
FROM
(
SELECT
IF(ISNULL(ENERO),'0',ENERO) AS ENERO,
IF(ISNULL(FEBRERO),'0',FEBRERO) AS FEBRERO,
IF(ISNULL(MARZO),'0',MARZO) AS MARZO,
IF(ISNULL(ABRIL),'0',ABRIL) AS ABRIL,
IF(ISNULL(MAYO),'0',MAYO) AS MAYO,
IF(ISNULL(JUNIO),'0',JUNIO) AS JUNIO,
IF(ISNULL(JULIO),'0',JULIO) AS JULIO,
IF(ISNULL(AGOSTO),'0',AGOSTO) AS AGOSTO,
IF(ISNULL(SEPTIEMBRE),'0',SEPTIEMBRE) AS SEPTIEMBRE,
IF(ISNULL(OCTUBRE),'0',OCTUBRE) AS OCTUBRE,
IF(ISNULL(NOVIEMBRE),'0',NOVIEMBRE) AS NOVIEMBRE,
IF(ISNULL(DICIEMBRE),'0',DICIEMBRE) AS DICIEMBRE,
ENERO+FEBRERO+MARZO+ABRIL+MAYO+JUNIO+JULIO+AGOSTO+SEPTIEMBRE+OCTUBRE+NOVIEMBRE+DICIEMBRE AS TOTALES
FROM material_type_dm M
LEFT JOIN
(
SELECT MATERIAL_CD,
MAX(ENERO) AS ENERO,MAX(FEBRERO) AS FEBRERO,MAX(MARZO) AS MARZO,MAX(ABRIL) AS ABRIL,
MAX(MAYO) AS MAYO,MAX(JUNIO) AS JUNIO,MAX(JULIO) AS JULIO,MAX(AGOSTO) AS AGOSTO,MAX(SEPTIEMBRE) AS SEPTIEMBRE,
MAX(OCTUBRE) AS OCTUBRE,MAX(NOVIEMBRE) AS NOVIEMBRE,MAX(DICIEMBRE) AS DICIEMBRE
FROM
(
SELECT MATERIAL_CD, count(bibid) AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '01'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, count(bibid) AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '02'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, count(bibid) AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '03'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, count(bibid) AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '04'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, count(bibid) AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '05'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, count(bibid) AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '06'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, count(bibid) AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '07'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, count(bibid) AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '08'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, count(bibid) AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '09'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, count(bibid) AS OCTUBRE, 0 AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '10'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, count(bibid) AS NOVIEMBRE, 0 AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '11'
GROUP BY MATERIAL_CD
UNION
SELECT MATERIAL_CD, 0 AS ENERO, 0 AS FEBRERO, 0 AS MARZO, 0 AS ABRIL, 0 AS MAYO, 0 AS JUNIO, 0 AS JULIO, 0 AS AGOSTO, 0 AS SEPTIEMBRE, 0 AS OCTUBRE, 0 AS NOVIEMBRE, count(bibid) AS DICIEMBRE
FROM BIBLIO
WHERE date_format(create_dt,'%Y') = -1 and date_format(create_dt,'%m') = '12'
GROUP BY MATERIAL_CD
) A
GROUP BY MATERIAL_CD
) B ON B.MATERIAL_CD = M.CODE
) T
  </sql>
</report>
